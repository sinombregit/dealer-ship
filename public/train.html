
<!DOCTYPE html>
<html lang="en">

  <head>

    <!-- Title for the page -->

    <title>Multiple object detection using pre trained model in TensorFlow.js</title>

    <!-- Tag to specify the character set that the page uses -->

    <meta charset="utf-8">


    <!-- Import the webpage's stylesheet so that CSS is applied from style.css -->

    <link rel="stylesheet" href="css/style_recon.css">
    <style>
        .marcador{
            width: 5px;
            height: 5px;
            background: #FF6F00;
        }
    </style>

  </head>  

  <body>
  <h1>TensorFlow Hub Load Raw TFJS MoveNet Model</h1>

       <div id="lienzo" style=" position: relative;"> 

    <img id="exampleImg" width="640" height="360" crossorigin src="https://storage.googleapis.com/jmstore/TensorFlowJS/EdX/standing.jpg" />
</div>

   <!-- Import TensorFlow.js library -->

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js" type="text/javascript"></script>

    <!-- Load the coco-ssd model (always afer loading TensorFlow.js to use to  recognize things in images. -->
        

    <script>
      const MODEL_PATH = 'https://tfhub.dev/google/tfjs-model/movenet/singlepose/lightning/4';

const EXAMPLE_IMG = document.getElementById('exampleImg');

let movenet = undefined;
let arrayOutput

async function loadAndRunModel() {

  movenet = await tf.loadGraphModel(MODEL_PATH, {fromTFHub: true});


  let exampleInputTensor = tf.zeros([1, 192, 192, 3], 'int32');

  let imageTensor = tf.browser.fromPixels(EXAMPLE_IMG);

  console.log(imageTensor.shape);

  

  let cropStartPoint = [15, 170, 0];

  let cropSize = [345, 345, 3];

  let croppedTensor = tf.slice(imageTensor, cropStartPoint, cropSize);


  let resizedTensor = tf.image.resizeBilinear(croppedTensor, [192, 192], true).toInt();

  console.log(resizedTensor.shape);

  

  let tensorOutput = movenet.predict(tf.expandDims(resizedTensor));

  arrayOutput = await tensorOutput.array();

  var lienzo=document.getElementById('lienzo')

  arrayOutput[0].forEach(y  => {

    y.forEach(x =>
  {
    var marcador=document.createElement("div")

    console.log(x)

    marcador.setAttribute("class", "marcador")
    marcador.style.position='absolute'
    marcador.style.left=x[1]*192+170+'px'
    marcador.style.top=x[0]*192+15+'px'

    lienzo.appendChild(marcador)
  })
  });

  console.log(arrayOutput);

}


loadAndRunModel()

    </script>    

    <!-- Import the page's JavaScript to do some stuff -->

    

  </body>

</html>